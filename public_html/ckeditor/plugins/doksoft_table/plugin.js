var pluginName="doksoft_table";CKEDITOR.plugins.add(pluginName,{lang:"en,ru",requires:["panelbutton","floatpanel",],icons:pluginName,init:function(d){if(typeof d.lang.doksoft_table.doksoft_table!="undefined"){d.lang.doksoft_table=d.lang.doksoft_table.doksoft_table;}if(false){if(CKEDITOR.version.charAt(0)=="4"){d.ui.addButton("doksoft_table",{command:"doksoft_table",icon:this.path+"icons/doksoft_table_4.png"});}else{d.ui.addButton("doksoft_table",{command:"doksoft_table",icon:this.path+"icons/doksoft_table.png"});}}var e=0,c=function(b){var m=document.getElementById(b);var l=m.getBoundingClientRect(),n=document.body,h=document.documentElement,g=window.pageYOffset||h.scrollTop||n.scrollTop,j=window.pageXOffset||h.scrollLeft||n.scrollLeft,k=h.clientTop||n.clientTop||0,o=h.clientLeft||n.clientLeft||0,p=l.top+g-k,i=l.left+j-o;return{top:Math.round(p),left:Math.round(i)};};d.on("instanceReady",function(b){e=document.createElement("div");e.setAttribute("id","cke_"+pluginName+"_"+d.name);e.setAttribute("style","display:none;background:#fff; border:1px solid #ccc;padding:5px;position:absolute; width:150px;font-family:Arial;font-size:12px;z-index:"+(d.config.baseFloatZIndex+1));var k=""+'<div style="font-size: 14px; vertical-align:middle; height:20px; line-height:1; display:block;padding-top:4px;">'+"<input "+(((b.editor.config.doksoft_table_default_100&&["yes",1,true].indexOf(b.editor.config.doksoft_table_default_100)!=-1))?"checked":"")+' style="vertical-align:middle;display:table-cell" type="checkbox" id="cke_'+pluginName+"_100_"+d.name+'"/>'+"&nbsp;width:100%"+"</div>"+'<div><table border="0" cellpadding="1" cellspacing="1">';var n=d.config.doksoft_table_gui_width||6,m=d.config.doksoft_table_gui_height||6;var p=Math.round(140/n);for(var l=1;l<=m;l++){k+='<tr id="'+pluginName+"_tr_"+l+'">';for(var h=1;h<=n;h++){k+='<td id="'+pluginName+"_td_"+l+"_"+h+'" style="border:1px solid #c3d9ff; background-color:#ddeafb;width:'+p+"px;height:"+p+'px;"></td>';}k+="</tr>";}k+='</table></div><div id="cke_'+pluginName+"_size_"+d.name+'" style="text-align:center">1:1</div>';e.innerHTML=k;document.body.appendChild(e);e.onmouseover=function(v){var t=v||window.event;var u=(t.srcElement||t.target);if(u.tagName.toLowerCase()=="td"){var q=/^doksoft_table_td_([0-9]+)_([0-9]+)$/.exec(u.id);for(var s=1;s<=m;s++){for(var r=1;r<=n;r++){document.getElementById(pluginName+"_td_"+s+"_"+r).style.backgroundColor=(s<=parseInt(q[1])&&r<=parseInt(q[2]))?"#abcfff":"#ddeafb";}}document.getElementById("cke_"+pluginName+"_size_"+d.name).innerHTML=q[1]+":"+q[2];}};var o=function(j,i){return new Array(++i).join(j);};var g=function(i){return new CKEDITOR.dom.element(i,d.document);};e.onmousedown=function(C){var A=d.getSelection(),s=A.createBookmarks();var w=C||window.event;var y=(w.srcElement||w.target);if(y.tagName.toLowerCase()=="td"){var D=/^doksoft_table_td_([0-9]+)_([0-9]+)$/.exec(y.id),t="",B=g("table"),v=B.append(g("tbody"));if(document.getElementById("cke_"+pluginName+"_100_"+d.name).checked){B.setStyle("width","100%");}var x="cke_show_border "+(b.editor.config.doksoft_table_class?b.editor.config.doksoft_table_class:"");B.setAttribute("class",x);var z,q;for(var u=1;u<=parseInt(D[1]);u++){z=v.append(g("tr"));for(var r=1;r<=parseInt(D[2]);r++){q=z.append(g("td"));if(!CKEDITOR.env.ie){q.append(g("br"));}}}e.style.display="none";d.insertElement(B);setTimeout(function(){var j=g(B.$.rows[0].cells[0]);var i=new CKEDITOR.dom.range(d.document);i.moveToPosition(j,CKEDITOR.POSITION_AFTER_START);i.select(true);d.focus();},10);}else{if(y.tagName.toLowerCase()!="input"){}}w.stopPropagation();};d.on("contentDom",function(){d.editable().on("mousedown",function(i){e.style.display="none";});});d.document.$.addEventListener("mousedown",function(i){e.style.display="none";},false);window.addEventListener("mousedown",function(q){var i=q||window.event;var j=(i.srcElement||i.target);if(e.style.display=="block"&&j.tagName.toLowerCase()!="input"){e.style.display="none";}},false);});var f=d.addCommand(pluginName,{exec:function(b){e.style.display="block";var g=c(this.uiItems[0]._.id);e.style.left=(g.left+16)+"px";e.style.top=(g.top+16)+"px";}});var a=0;d.ui.add(pluginName,CKEDITOR.UI_PANELBUTTON,{label:d.lang[pluginName].add_table,title:d.lang[pluginName].add_table,editorFocus:1,modes:{wysiwyg:1},className:"cke_button_/*BOOTSTRAP*/bootstrap_/*BOOTSTRAP*/table",panel:{attributes:{role:"listbox","aria-label":""}},onBlock:function(b,g){window[pluginName+d.name]=this._.id;b.onShow=function(){var h=c(window[pluginName+d.name]);this.element.setStyle("visibility","hidden");e.style.display="block";e.style.left=(h.left)+"px";e.style.top=(h.top+24)+"px";};},});}});